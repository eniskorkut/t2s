datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
  enable_experimental_decimal = true
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password_hash String
  role          String   @default("user")
  created_at    DateTime @default(now())

  @@map("users")
}

model PasswordResetToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  email      String
  expires_at DateTime
  created_at DateTime @default(now())

  @@map("password_reset_tokens")
}

// Business Domain Models
model Employee {
  id           Int      @id @default(autoincrement())
  name         String
  department   String
  salary       Decimal  @db.Decimal(10, 2)
  hire_date    DateTime @map("hire_date") @db.Date
  
  // Relations
  personal_info EmployeePersonalInfo?
  projects      EmployeeProject[]

  @@map("employees")
}

model EmployeePersonalInfo {
  id          Int      @id @default(autoincrement())
  employee_id Int      @unique
  email       String
  phone       String?
  address     String?
  birth_date  DateTime? @map("birth_date") @db.Date

  // Relations
  employee    Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@map("employee_personal_info")
}

model Project {
  id          Int      @id @default(autoincrement())
  name        String
  description String?  @db.Text
  start_date  DateTime? @map("start_date") @db.Date
  end_date    DateTime? @map("end_date") @db.Date
  budget      Decimal?  @db.Decimal(12, 2)

  // Relations
  employees   EmployeeProject[]

  @@map("projects")
}

model EmployeeProject {
  id           Int @id @default(autoincrement())
  employee_id  Int
  project_id   Int
  role         String?
  hours_worked Int? @map("hours_worked")

  // Relations
  employee     Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade)
  project      Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([employee_id, project_id])
  @@map("employee_projects")
}
